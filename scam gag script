-- === Profile (Avatar + Nick) ===
local Players = game:GetService("Players")
local player = Players.LocalPlayer or Players.PlayerAdded:Wait()

-- Контейнер под авто-лейаут content (ничего не ломает)
local profileContainer = Instance.new("Frame")
profileContainer.Name = "ProfileContainer"
profileContainer.BackgroundTransparency = 1
profileContainer.Size = UDim2.new(1, 0, 0, 150)
profileContainer.Parent = content

local profileLayout = Instance.new("UIListLayout")
profileLayout.FillDirection = Enum.FillDirection.Vertical
profileLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
profileLayout.VerticalAlignment = Enum.VerticalAlignment.Top
profileLayout.Padding = UDim.new(0, 6)
profileLayout.Parent = profileContainer

-- Аватар в круге
local avatarHolder = Instance.new("Frame")
avatarHolder.BackgroundTransparency = 1
avatarHolder.Size = UDim2.fromOffset(110, 110)
avatarHolder.Parent = profileContainer

local avatarFrame = Instance.new("ViewportFrame")
avatarFrame.Name = "AvatarFrame"
avatarFrame.Size = UDim2.fromOffset(100, 100)
avatarFrame.Position = UDim2.fromOffset(5, 5)
avatarFrame.BackgroundTransparency = 1
avatarFrame.Parent = avatarHolder

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(1, 0)
corner.Parent = avatarFrame

local stroke = Instance.new("UIStroke")
stroke.Thickness = 2
stroke.Color = COLORS.Accent
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
stroke.Parent = avatarFrame

-- Ник под аватаром
local usernameLabel = Instance.new("TextLabel")
usernameLabel.Name = "UsernameLabel"
usernameLabel.BackgroundTransparency = 1
usernameLabel.Size = UDim2.new(1, -20, 0, 22)
usernameLabel.Text = player.DisplayName or player.Name
usernameLabel.Font = Enum.Font.GothamBold
usernameLabel.TextSize = 18
usernameLabel.TextColor3 = COLORS.Text
usernameLabel.TextXAlignment = Enum.TextXAlignment.Center
usernameLabel.Parent = profileContainer

-- Сборка 3D-аватара + камера
local function rebuildAvatar()
    -- чистим предыдущие модель/камеру, не трогая UI
    for _, ch in ipairs(avatarFrame:GetChildren()) do
        if ch:IsA("Camera") or ch:IsA("Model") then
            ch:Destroy()
        end
    end

    local cam = Instance.new("Camera")
    cam.Parent = avatarFrame
    avatarFrame.CurrentCamera = cam

    local char = player.Character or player.CharacterAdded:Wait()
    local clone = char:Clone()
    clone.Parent = avatarFrame

    for _, obj in clone:GetDescendants() do
        if obj:IsA("BasePart") then
            obj.Anchored = true
            obj.CanCollide = false
        elseif obj:IsA("Script") or obj:IsA("LocalScript") then
            obj:Destroy()
        end
    end

    -- позиционирование и кадр
    local hrp = clone:FindFirstChild("HumanoidRootPart") or clone:FindFirstChild("Torso")
    if hrp and not clone.PrimaryPart then
        clone.PrimaryPart = hrp
    end
    if clone.PrimaryPart then
        clone:PivotTo(CFrame.new(0, 0, 0))
    end

    local lookAt = Vector3.new(0, 1.5, 0)
    cam.CFrame = CFrame.new(lookAt + Vector3.new(0, 0.2, 4), lookAt)
    cam.FieldOfView = 50
end

-- первая сборка и обновление при респауне
task.spawn(rebuildAvatar)
player.CharacterAdded:Connect(function()
    task.wait(0.2)
    rebuildAvatar()
end)
